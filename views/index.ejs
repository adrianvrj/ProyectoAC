<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
</head>
<style>
    body {
        background-color: black;
        color: white;
        font-family: Arial, Helvetica, sans-serif;
    }

    .maindiv {
        margin-left: 38%;
        font-size: xx-large;
    }

    .filterform {
        font-size: medium;
    }

    .maindiv h1 {
        margin-left: 5%;
    }

    .tablaplanilla {
        margin-top: 3%;
        border-collapse: collapse;
        margin-left: 1%;
    }

    th {
        background-color: white;
        color: black;
        border: 1px solid white;
        padding: 8px;
        text-align: left;
    }

    td {
        border: 1px solid white;
        padding: 8px;
        text-align: left;
        color: black;
        background-color: white;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
</style>

<body>
    <div class="maindiv">
        <h1>SICPLA</h1>
        <div class="filterform">
            <h5>Buscar planilla por mes</h5>
            <form method="post" action="filtrarPlanilla">
                <select onchange="mes()" id="mes" name="mes">
                    <option value="">Selecciona un mes</option>
                    <option value="01">Enero</option>
                    <option value="02">Febrero</option>
                    <option value="03">Marzo</option>
                    <option value="04">Abril</option>
                    <option value="05">Mayo</option>
                    <option value="06">Junio</option>
                    <option value="07">Julio</option>
                    <option value="08">Agosto</option>
                    <option value="09">Septiembre</option>
                    <option value="10">Octubre</option>
                    <option value="11">Noviembre</option>
                    <option value="12">Diciembre</option>
                </select>
                <select name="anio">
                    <option value="">Selecciona el año</option>
                    <option value="2023">2023</option>
                </select>
                <button type="submit">Buscar</button>
            </form>
            <form method="post" action="generarPlanilla">
                <input type="text" value="" name="mes" id="mesGen" hidden>
                <button id="generarPlanilla" type="submit">Generar planilla</button>
            </form>
        </div>
    </div>
    <div class="tablaplanilla">
        <table id="planilla" class="tablaplanilla">
            <tr>
                <th>Número de planilla</th>
                <th>Cédula del empleado</th>
                <th>Deducciones obrero</th>
                <th>Deducciones patronales</th>
                <th>Impuesto de renta al salario</th>
                <th>Salario bruto</th>
                <th>Salario total</th>
                <th>Fecha</th>
                <th>Reporte</th>
            </tr>
        </table>
    </div>
</body>
<script>
    document.getElementById('mesGen').value = <%- (mes) %>;
    var planillas = <%- (planillas) %>;
    const n = planillas.length;
    if(n > 0){
        document.getElementById('generarPlanilla').disabled = true;
    }
    const table = document.getElementById('planilla');
    for(let planilla of planillas){
        var tr = document.createElement('tr');
        var nplanilla = document.createElement('td');
        nplanilla.textContent = planilla.nplanilla;
        var cedula = document.createElement('td');
        cedula.textContent = planilla.cedula;
        var deduccionesobrero = document.createElement('td');
        deduccionesobrero.textContent = planilla.deduccionesobrero;
        var deduccionespatronales = document.createElement('td');
        deduccionespatronales.textContent = planilla.deduccionespatronales;
        var impuestorentasalario = document.createElement('td');
        impuestorentasalario.textContent = planilla.impuestorentasalario;
        var salariobruto = document.createElement('td');
        salariobruto.textContent = planilla.salariobruto;
        var salariototal = document.createElement('td');
        salariototal.textContent = planilla.salariototal;
        var fecha = document.createElement('td');
        fecha.textContent = planilla.fecha;
        var reporte = document.createElement('td');
        var a = document.createElement('a');
        a.textContent = 'Ir al reporte';
        a.href = '/report/' + planilla.cedula + '/' + planilla.fecha + '/' + planilla.nplanilla;
        reporte.appendChild(a);
        tr.appendChild(nplanilla);
        tr.appendChild(cedula);
        tr.appendChild(deduccionesobrero);
        tr.appendChild(deduccionespatronales);
        tr.appendChild(impuestorentasalario);
        tr.appendChild(salariobruto);
        tr.appendChild(salariototal);
        tr.appendChild(fecha);
        tr.appendChild(reporte);
        table.appendChild(tr);
    };
</script>
</html>